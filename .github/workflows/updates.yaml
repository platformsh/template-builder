---
name: 'Updates'

on:
  push:
    branches:
      - 'pass-templates'

env:
    # Language-specific tools.
    POETRY_VERSION: "1.1.11"
    PYTHON_VERSION: "3.9"

jobs:
    # A. Get the list of templates that will be used in the update (all subdirectories in `templates/`).
    build:
        runs-on: ubuntu-latest
        name: 'Get templates list'
        outputs:
            templates: ${{ steps.getlist.outputs.templates }}
        steps: 
          - uses: actions/checkout@v2
          - name: Setup Python
            uses: actions/setup-python@v2
            with:
              python-version: ${{ env.PYTHON_VERSION }}
          - name: 'Get template list'
            id: getlist
            run: |
              TEMPLATES=$(python -c '
              import os
              import json
              dirs=os.listdir("{}/templates".format(os.getcwd()))
              dirs.remove("__init__.py")
              test = {"template": dirs}
              print(json.dumps(dirs))
              ')
              echo "::set-output name=templates::$TEMPLATES"

    # B. Run an update on all 
    updatea:
        needs: build
        runs-on: ubuntu-latest
        name: 'UpdateA'
        strategy:
            fail-fast: false
            matrix: 
                template: ${{fromJSON(needs.build.outputs.templates)}}
        steps: 
            # 0. Install tools and dependencies.
            - uses: actions/checkout@v2
            - name: Do something simple
              run: |
                  echo "${{ matrix.template }}" > path/to/artifact/world.txt
            - uses: actions/upload-artifact@master
              with:
                name: my-artifact
                path: path/to/artifact
